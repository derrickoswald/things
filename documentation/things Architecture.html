<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<title></title>
	<meta name="generator" content="LibreOffice 4.2.7.2 (Linux)">
	<meta name="created" content="20150313;103121795478002">
	<meta name="changed" content="20150313;181642124259642">
	<style type="text/css">
	<!--
		@page { margin: 0.79in }
		p { margin-bottom: 0.1in; line-height: 120% }
		h1 { margin-bottom: 0.08in }
		h1.western { font-family: "Liberation Sans", sans-serif; font-size: 18pt }
		h1.cjk { font-family: "Droid Sans Fallback"; font-size: 18pt }
		h1.ctl { font-family: "FreeSans"; font-size: 18pt }
		a:link { so-language: zxx }
	-->
	</style>
</head>
<body lang="en-US" dir="ltr">
<p align="center" style="margin-top: 0.17in; margin-bottom: 0.08in; line-height: 100%; page-break-after: avoid">
<font face="Liberation Sans, sans-serif"><font size="6" style="font-size: 28pt"><b><i>things</i>
Architecture</b></font></font></p>
<h1 class="western">Overview</h1>
<p style="margin-bottom: 0in; line-height: 100%">The <i>things</i>
application is a client-server system intended to create, manage and
share <i>thing</i> objects. A <i>th</i><i>ing</i> is a torrent file
with additional metadata as specified by the <a href="http://thingtracker.net/" name="thingtrackernetwork" target="_blank">Thing
Tracker Network</a> as well as the files that are identified by the
torrent's file list and normally distributed using the <a href="http://bittorrent.org/" name="bittorrent" target="_blank">BitTorrent
protocol</a>. A simplified view of a sample <i>thing</i> is shown in
Figure 1.</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%">[Figure 1 – Sample
thing]</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%">The three main
components of the system are the <a href="https://couchdb.apache.org/" name="couchdb" target="_blank">Apache
CouchDB™ database</a>, the <a href="http://deluge-torrent.org/" name="deluge" target="_blank">Deluge
BitTorrent client</a>, and an <a href="https://en.wikipedia.org/wiki/HTML5" name="html5" target="_blank">HTML5</a>
compatible browser such as <a href="https://www.google.com/chrome/" name="chrome" target="_blank">Chrome</a>
or <a href="https://www.mozilla.org/en-US/firefox/new/" name="firefox" target="_blank">Firefox</a>.
A simplified view of the application is shown in Figure 2.</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%">[Figure 2 – <i>things</i>
application]</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<h1 class="western">Client</h1>
<p style="margin-bottom: 0in; line-height: 100%">{link to another
page with a short description of Javascript: ECMA, relation to java,
interactive, weakly typed, etc. }</p>
<p style="margin-bottom: 0in; line-height: 100%"> 
</p>
<p style="margin-bottom: 0in; line-height: 100%">In addition to
providing the <a href="https://en.wikipedia.org/wiki/Representational_state_transfer" name="restful" target="_blank">RESTful
APIs</a> for document storage and retrieval, the CouchDB web server
is used to serve static content, including a number of JavaScript
files which comprise the bulk of the application logic; that is, most
application functionality is executing on the client side. In
addition to the application specific JavaScript files, the third
party components that are used on the client side of the application
are:</p>
<ul>
	<li><p style="margin-bottom: 0in; line-height: 100%"><a href="http://www.requirejs.org/" name="requirejs" target="_blank">RequireJS
	2.1.14</a> loader to structure the application code into modules and
	to handle dependencies when loading JavaScript files</p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><a href="https://jquery.com/" name="jquery" target="_blank">jQuery
	2.1.3</a> (supersedes the jQuery v1.8.3 that comes bundled with
	CouchDB) is used to provide additional functionality to, and
	homogenization of, the JavaScript engines used by the supported
	browsers</p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><a href="http://github.com/janl/mustache.js" name="mustache" target="_blank">mustache.js
	1.1.0</a> templating engine to provide HTML template processing that
	eases the repetitive and error-prone task of programatically
	generating HTML content from arrays of JavaScript objects</p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><a href="http://getbootstrap.com/" name="bootstrap" target="_blank">Bootstrap
	3.3.2</a> cascading style sheet (CSS) files and a corresponding
	JavaScript file that is used to provide industry standard styling
	and on-screen widgets and functionality</p>
</ul>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%">Normally the jQuery
and Bootstrap components are served by the <a href="https://www.maxcdn.com/" name="maxcdn" target="_blank">MaxCDN</a>
content delivery network to ease bandwidth requirements of hosting
systems, but a static version of the start page can be used while
off-line to accomplish basic workflows. A simplified view of the
client side application is shown in Figure 3.</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%">[Figure 3 – Client
side components]</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<h1 class="western">Server</h1>
<p style="margin-bottom: 0in; line-height: 100%">{link to another
page with a short description of CouchDB: nosql, JSON documents,
erlang, design documents, views, lists, versioning, replication,
etc.}</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%">The databases hosted
by the CouchDB server are:</p>
<ul>
	<li><p style="margin-bottom: 0in; line-height: 100%"><b>things</b>,
	the local database of user generated <i>things</i></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><b>public_things</b>,
	the replicated database of community published <i>things</i></p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><b>pending_things</b>,
	the inbox for imported <i>things</i></p>
</ul>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%">These databases have
design documents that provide data validation and views that are
specific to the application. To avoid restrictions prohibiting
<a href="https://en.wikipedia.org/wiki/Cross-site_scripting" name="xss" target="_blank">cross-site
scripting (XSS)</a>, CouchDB's <a href="http://docs.couchdb.org/en/1.6.1/config/proxying.html" name="proxy" target="_blank">proxy
capability</a> is used to federate services under one url for
consumption by the client. These services are:</p>
<ul>
	<li><p style="margin-bottom: 0in; line-height: 100%"><a href="http://deluge-torrent.org/docs/master/modules/ui/web/json_api.html" name="deluge-web" target="_blank">Deluge
	web api</a> which provides RESTful services to add, query and delete
	torrent files</p>
	<li><p style="margin-bottom: 0in; line-height: 100%"><a href="https://keybase.io/" name="keybase" target="_blank">Keybase</a>
	which provides RESTful services to retrieve security credentials</p>
</ul>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%">The (lucene or solr)
text search engine is running on the same node as the database to
provide full text indexing. <i><b>TBD</b></i></p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%">Multiple
installations of the <i>thing</i> application are joined together by
replication of the public_things database using the <a href="http://docs.couchdb.org/en/1.6.1/replication/index.html" name="replication" target="_blank">replication</a>
functionality of CouchDB, such that eventually all connected systems
will have a consistent view of all published <i>things</i>. A
simplified view of the server side application is shown in Figure 4.</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%">[Figure 4 – Server
side components]</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<h1 class="western">User Scripts</h1>
<p style="margin-bottom: 0in; line-height: 100%">A few ancillary
components provide additional functionality to aid in importing
<i>things</i>. <a href="http://www.greasespot.net/" name="greasemonkey" target="_blank">Greasemonkey</a>
user script for Firefox (eventually) Chrome intercede on the users
behalf to allow seamless export from existing sites such as
Thingiverse and Youmagine and import to the <i>things</i> system. The
CouchDB <a href="http://docs.couchdb.org/en/1.6.1/config/http.html?highlight=cors#cross-origin-resource-sharing" name="cors" target="_blank">CORS</a>
functionality is used to allow POST operations to CouchDB while
visiting the legacy site. The imported things are held in the
pending_things database until reviewed and posted to the
public_things database. A simplified diagram of these user scripts is
shown in Figure 5.</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%">[Figure 5 – User
script components]</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<h1 class="western">Operation</h1>
<p style="margin-bottom: 0in; line-height: 100%">The following
scenario describes a typical use-case where a designer wants to share
her designs on the Thing Tracker Network. It is just an example for
illustrative purposes and elides much detail in favor of simplicity.
Technical users should refer to the appropriate module for additional
details.</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%">The designer has a
design that has met some milestone and she would like to share it
with colleagues in the community. She browses to a <i>things</i>
system running on her local machine. 
</p>
<p style="margin-bottom: 0in; line-height: 100%">Using the Thing
Wizard, she specifies the files to be included in the <i>thing</i>
and the metadata to associate with it and uploads the new <i>thing</i>
to her local things database. She could optionally use an existing
<i>thing</i> as a template to create a new version and/or she could
optionally sign the <i>thing</i> with her private key to  prove to
others that she made this <i>thing</i> and/or verify that the new
<i>thing</i> is a verified new version of the original.</p>
<p style="margin-bottom: 0in; line-height: 100%">She then publishes
the <i>thing</i> to the public_things database which also places the
torrent file and the associated files into Deluge. Deluge begins to
seed the <i>thing</i> as with any other torrent.</p>
<p style="margin-bottom: 0in; line-height: 100%">When the
public_things database is replicated to other systems, her new <i>thing</i>
is dispersed to these other systems as a document with an attached
torrent file.</p>
<p style="margin-bottom: 0in; line-height: 100%">Her new <i>thing</i>
is visible now when someone in the community browses or searches
their own copy of the public_thing database. Should they request the
<i>thing</i> be copied locally, their own <i>things</i> system places
the torrent file into Deluge. Deluge then begins the torrent download
and when it is finished, her design files are now available local
use.</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
<p style="margin-bottom: 0in; line-height: 100%"><br>
</p>
</body>
</html>